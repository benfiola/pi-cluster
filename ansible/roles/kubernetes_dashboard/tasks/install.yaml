- name: apply manifest
  block:
  - include_role: {name: utils, tasks_from: dl_to_temp_file}
    vars: {url: "{{kd_manifest_url}}"}

  - name: apply manifest
    become: true
    kubernetes.core.k8s:
      state: present
      src: "{{tempfile.path}}"
      wait: true

- name: apply service manifest
  become: true
  kubernetes.core.k8s:
    state: present
    definition: "{{lookup('template', 'templates/service.yaml')}}"
    wait: true

- name: apply admin user manifest
  become: true
  kubernetes.core.k8s:
    state: present
    definition: "{{lookup('template', 'templates/admin_user.yaml')}}"
    wait: true
